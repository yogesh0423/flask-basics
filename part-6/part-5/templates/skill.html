{% extends "base.html" %}

{% block title %}Projects using {{ skill_name }} | {{ info.name }}{% endblock %}

{% block content %}
<div class="card">
    <h2>Projects using {{ skill_name }}</h2>
    <p>Here are the projects that utilize {{ skill_name }}. Click on any project to see more details!</p>

    <div class="info-box">
        <strong>Dynamic Route:</strong>
        <p>This page is generated dynamically for the skill: <code>{{ skill_name }}</code></p>
    </div>
</div>

{% if projects %}
<!-- Projects Grid -->
<div class="projects-grid">
    {% for project in projects %}
    <div class="project-card">
        <h3>{{ project.name }}</h3>
        <p>{{ project.description }}</p>

        <!-- Tech tags using a nested loop -->
        <div class="tech-tags">
            {% for tech in project.tech %}
                <span class="tech-tag">{{ tech }}</span>
            {% endfor %}
        </div>

        <!-- Status badge with conditional styling -->
        {% if project.status == 'Completed' %}
            <span class="status status-completed">{{ project.status }}</span>
        {% elif project.status == 'In Progress' %}
            <span class="status status-in-progress">{{ project.status }}</span>
        {% else %}
            <span class="status status-planned">{{ project.status }}</span>
        {% endif %}

        <div style="margin-top: 15px;">
            <a href="{{ url_for('project_detail', project_id=project.id) }}" class="btn btn-primary">
                View Details
            </a>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Stats -->
<div class="card" style="margin-top: 20px;">
    <h2>Statistics for {{ skill_name }}</h2>
    <p><strong>Total Projects using {{ skill_name }}:</strong> {{ projects|length }}</p>

    <p style="margin-top: 10px;">
        <strong>By Status:</strong>
    </p>
    <ul style="margin-left: 20px;">
        <li>Completed: {{ projects|selectattr('status', 'equalto', 'Completed')|list|length }}</li>
        <li>In Progress: {{ projects|selectattr('status', 'equalto', 'In Progress')|list|length }}</li>
        <li>Planned: {{ projects|selectattr('status', 'equalto', 'Planned')|list|length }}</li>
    </ul>
</div>
{% else %}
<div class="card">
    <h2>No Projects Found</h2>
    <p>Sorry, there are no projects that use {{ skill_name }} at the moment.</p>
    <p><a href="{{ url_for('projects') }}" class="btn btn-primary">View All Projects</a></p>
</div>
{% endif %}
{% endblock %}
